# 로또 번호 생성 전략 가이드

이 문서는 로또 번호 생성 플랫폼에서 제공하는 모든 번호 생성 전략에 대한 상세 설명입니다.

## 목차

1. [전략 개요](#전략-개요)
2. [전략별 상세 설명](#전략별-상세-설명)
3. [기본 게임 개수](#기본-게임-개수)
4. [알고리즘 상세](#알고리즘-상세)

---

## 전략 개요

현재 플랫폼에서 제공하는 번호 생성 전략은 총 6가지입니다:

| 전략 | 이름 | 기본 게임 개수 | 설명 | AI 요소 |
|------|------|---------------|------|---------|
| `FREQUENT_TOP` | 고빈도 우선 | 5 | 통계적으로 자주 나온 번호 우선 선택 | ❌ 없음 |
| `OVERDUE_TOP` | 과거 데이터 우선 | 5 | 최근에 나오지 않은 번호 우선 선택 | ❌ 없음 |
| `BALANCED` | 균형 | 5 | 고빈도와 과거 데이터를 균형있게 조합 | ❌ 없음 |
| `WHEELING_SYSTEM` | 추천조합1 (기본 14게임) | 14 | 5등(3개 일치) 보장 조합 (14게임 권장) | ❌ 없음 |
| `WEIGHTED_RANDOM` | 가중치 기반 생성 | 5 | 빈도와 과거 데이터를 결합한 가중치로 랜덤 추출 | ❌ 없음 |
| `PATTERN_MATCHER` | 패턴 필터링 | 5 | 과거 당첨 패턴과 일치하는 조합만 생성 | ❌ 없음 |

**참고**: 모든 전략이 현재 **통계/수학 기반 알고리즘**으로 구현되어 있으며, AI/ML 모델을 사용하지 않습니다. 자세한 내용은 [전략별 AI 요소 분류 가이드](./strategy-ai-classification.md)를 참고하세요.

---

## 전략별 상세 설명

### 1. 고빈도 우선 (FREQUENT_TOP)

**설명**: 과거 당첨 번호 중 자주 나온 번호를 우선적으로 선택합니다. 통계적으로 자주 등장한 번호에 집중하는 전략입니다.

**특징**:
- 최근 N회 추첨(기본 50회)에서 고빈도 번호를 우선 선택
- 빈도가 높을수록 높은 가중치를 부여하여 선택 확률 증가
- 통계적 패턴을 활용한 번호 선택

**알고리즘**:
1. 1~45번 전체 번호를 후보 풀로 생성
2. 제약 조건(포함/제외 번호) 적용
3. 메트릭 데이터 기반으로 각 번호의 빈도(frequency) 계산
4. 빈도가 높은 순서로 정렬하여 상위 6개 선택
5. 메트릭 데이터가 없는 경우 랜덤 선택

**적용 시나리오**:
- 통계적으로 검증된 번호를 선호하는 경우
- 과거 당첨 패턴을 신뢰하는 경우

---

### 2. 과거 데이터 우선 (OVERDUE_TOP)

**설명**: 최근에 나오지 않은 번호를 우선적으로 선택합니다. 오랫동안 나오지 않은 번호에 집중하는 전략입니다.

**특징**:
- 최근에 나오지 않은 번호(overdue 값이 큰 번호) 우선 선택
- 오래 안 나온 번호일수록 높은 가중치 부여
- "나올 차례"라는 가설에 기반한 선택

**알고리즘**:
1. 1~45번 전체 번호를 후보 풀로 생성
2. 제약 조건(포함/제외 번호) 적용
3. 메트릭 데이터 기반으로 각 번호의 과거 데이터(overdue) 계산
4. overdue 값이 큰 순서로 정렬하여 상위 6개 선택
5. 메트릭 데이터가 없는 경우 랜덤 선택

**적용 시나리오**:
- 오래 나오지 않은 번호가 곧 나올 것이라고 믿는 경우
- 역발상 전략을 선호하는 경우

---

### 3. 균형 (BALANCED)

**설명**: 고빈도 번호와 과거 데이터를 균형있게 조합하여 선택합니다. 다양한 번호를 포함하는 전략입니다.

**특징**:
- 고빈도와 과거 데이터를 모두 고려한 균형잡힌 선택
- 제약 조건(홀수/짝수 비율, 합계 범위 등) 적용 가능
- 가장 일반적이고 안정적인 전략

**알고리즘**:
1. 1~45번 전체 번호를 후보 풀로 생성
2. 제약 조건(포함/제외 번호, 홀수/짝수 비율, 합계 범위) 적용
3. 제약 조건을 만족하는 조합을 랜덤으로 생성
4. 최대 1000회 시도하여 제약 조건을 만족하는 조합 선택
5. 제약 조건을 만족하지 못하면 기본 랜덤 선택

**제약 조건**:
- `includeNumbers`: 반드시 포함할 번호 목록
- `excludeNumbers`: 제외할 번호 목록
- `oddEvenRatioRange`: 홀수/짝수 비율 범위
- `sumRange`: 번호 합계 범위

**적용 시나리오**:
- 가장 일반적인 사용 케이스
- 특정 제약 조건을 적용하고 싶은 경우
- 다양한 번호 조합을 원하는 경우

---

### 4. 추천조합1 (기본 14게임) (WHEELING_SYSTEM)

**설명**: 5등(번호 3개 일치) 보장 조합입니다. 통계적으로 가장 안 나온 9개 번호를 제외한 36개 번호로 조합을 생성합니다. 기본값은 14게임이며, 5등 보장을 위해 14게임을 권장합니다. 당첨 번호 6개가 포함되어 있다는 가정하에 최소 5등 1개 이상을 보장합니다.

**특징**:
- 기본 게임 개수: 14게임 (변경 가능, 5등 보장을 위해 권장)
- 5등(3개 일치) 보장 알고리즘 (14게임 기준)
- 통계적으로 가장 안 나온 9개 번호 자동 제외
- 36개 번호를 요청한 개수만큼 조합에 균등하게 분산

**알고리즘**:

#### Step 1: 번호 제외
- 최근 N회 추첨(기본 50회)에서 통계적으로 가장 안 나온 9개 번호 제외
- 메트릭 데이터의 frequency 값이 가장 낮은 9개 번호 선택
- 메트릭 데이터가 없는 경우 랜덤으로 9개 제외

#### Step 2: 36개 번호 선택
- 전체 45개 번호에서 제외된 9개를 뺀 36개 번호 사용

#### Step 3: 조합 생성
- Round-Robin 방식으로 36개 번호를 요청한 개수만큼 조합에 균등하게 분산
- 각 번호가 여러 조합에 포함되도록 구성
- 각 조합은 정확히 6개 번호로 구성
- 3개 일치를 보장하기 위한 최소 커버리지 알고리즘 적용
- **5등 보장을 위해서는 14개 조합 권장**

**수학적 원리**:
- 36개 번호 중 당첨 번호 6개가 포함되어 있다는 가정
- 요청한 개수만큼 조합으로 36개 번호를 최대한 균등하게 커버
- 각 번호가 여러 조합에 분산되어 있어, 당첨 번호 6개 중 최소 3개가 한 조합에 포함될 확률이 높음
- **14개 조합일 때 5등 보장이 가장 안정적**

**적용 시나리오**:
- 5등 이상 당첨을 보장하고 싶은 경우
- 여러 게임을 구매하여 당첨 확률을 높이고 싶은 경우
- 통계적으로 검증된 번호 조합을 원하는 경우

**주의사항**:
- 기본 게임 개수는 14개이지만 변경 가능합니다
- **5등 보장을 위해서는 14게임을 권장합니다** (14개 미만일 경우 보장이 깨질 수 있음)
- 5등 보장은 "당첨 번호 6개가 36개 번호에 포함되어 있다"는 가정 하에 성립
- 실제 당첨 번호가 제외된 9개 번호에 포함되면 보장이 깨질 수 있음

---

## 기본 게임 개수

각 전략별 기본 게임 개수는 다음과 같습니다:

| 전략 | 기본 게임 개수 | 변경 가능 여부 |
|------|--------------|--------------|
| `FREQUENT_TOP` | 5 | ✅ 변경 가능 (1~20) |
| `OVERDUE_TOP` | 5 | ✅ 변경 가능 (1~20) |
| `BALANCED` | 5 | ✅ 변경 가능 (1~20) |
| `WHEELING_SYSTEM` | 14 | ✅ 변경 가능 (1~20, 5등 보장을 위해 14개 권장) |
| `WEIGHTED_RANDOM` | 5 | ✅ 변경 가능 (1~20) |
| `PATTERN_MATCHER` | 5 | ✅ 변경 가능 (1~20) |

**동작 방식**:
- 전략을 선택하면 해당 전략의 기본 게임 개수로 자동 설정됩니다
- 모든 전략에서 사용자가 게임 개수를 변경할 수 있습니다
- `WHEELING_SYSTEM`은 기본값이 14개이며, 5등 보장을 위해 14개를 권장합니다

---

## 알고리즘 상세

### 윈도우 사이즈 (Window Size)

모든 전략은 **윈도우 사이즈**를 사용하여 통계를 계산합니다.

- **기본값**: 50회
- **의미**: 최근 50회 추첨 데이터를 기준으로 통계 계산
- **용도**:
  - `FREQUENT_TOP`: 최근 50회에서의 빈도 계산
  - `OVERDUE_TOP`: 최근 50회에서의 과거 데이터 계산
  - `WHEELING_SYSTEM`: 최근 50회에서의 빈도를 기반으로 제외할 번호 선택

### 메트릭 데이터

각 번호에 대한 메트릭 데이터는 다음과 같습니다:

- **frequency**: 최근 N회 추첨에서 해당 번호가 나온 횟수
- **overdue**: 해당 번호가 마지막으로 나온 이후 경과한 추첨 횟수
- **lastSeenDrawNo**: 해당 번호가 마지막으로 나온 추첨 회차

### 데이터 부재 시 동작

메트릭 데이터가 없는 경우(초기 상태 또는 데이터 미갱신):
- 모든 전략은 **랜덤 선택 모드**로 동작합니다
- 1~45번 중에서 랜덤으로 6개 번호를 선택합니다
- 제약 조건이 있는 경우 제약 조건을 만족하는 범위에서 랜덤 선택

---

## API 사용 예시

### 고빈도 우선 전략

```json
POST /api/v1/generate
{
  "strategy": "FREQUENT_TOP",
  "count": 5,
  "windowSize": 50
}
```

### 과거 데이터 우선 전략

```json
POST /api/v1/generate
{
  "strategy": "OVERDUE_TOP",
  "count": 5,
  "windowSize": 50
}
```

### 균형 전략 (제약 조건 포함)

```json
POST /api/v1/generate
{
  "strategy": "BALANCED",
  "count": 5,
  "windowSize": 50,
  "constraints": {
    "includeNumbers": [7, 14, 21],
    "excludeNumbers": [1, 2, 3],
    "oddEvenRatioRange": {
      "min": 2,
      "max": 4
    },
    "sumRange": {
      "min": 100,
      "max": 200
    }
  }
}
```

### Wheeling System 전략

```json
POST /api/v1/generate
{
  "strategy": "WHEELING_SYSTEM",
  "count": 14,
  "windowSize": 50
}
```

**참고**: `WHEELING_SYSTEM`의 경우 `count` 값을 사용하여 요청한 개수만큼 조합을 생성합니다. 5등 보장을 위해서는 14개를 권장합니다.

### 가중치 기반 생성 전략

```json
POST /api/v1/generate
{
  "strategy": "WEIGHTED_RANDOM",
  "count": 5,
  "windowSize": 50
}
```

**참고**: `WEIGHTED_RANDOM`은 빈도와 과거 데이터를 50:50으로 결합한 가중치를 사용하여 랜덤하게 번호를 추출합니다.

### 패턴 필터링 전략

```json
POST /api/v1/generate
{
  "strategy": "PATTERN_MATCHER",
  "count": 5,
  "windowSize": 50
}
```

**참고**: `PATTERN_MATCHER`는 과거 당첨 데이터의 패턴과 일치하는 조합만 생성합니다. 패턴 일치도 60% 이상인 조합만 선택됩니다.

---

### 5. 가중치 기반 생성 (WEIGHTED_RANDOM)

**설명**: 빈도와 과거 데이터를 결합한 가중치를 사용하여 번호를 랜덤하게 추출합니다. 완전한 무작위가 아니라 통계 기반 확률로 번호를 선택합니다.

**특징**:
- 빈도와 과거 데이터를 50:50으로 결합한 가중치 사용
- 가중치가 높은 번호일수록 선택 확률이 높음
- 완전한 무작위가 아닌 통계 기반 확률 분포
- 다양한 조합 생성 가능

**알고리즘**:
1. 1~45번 전체 번호를 후보 풀로 생성
2. 제약 조건(포함/제외 번호) 적용
3. 메트릭 데이터 기반으로 빈도 가중치 계산
4. 메트릭 데이터 기반으로 과거 데이터(overdue) 가중치 계산
5. 빈도 가중치 50% + 과거 데이터 가중치 50%로 결합
6. 결합된 가중치를 기반으로 확률 분포 생성
7. 확률 분포에 따라 랜덤하게 번호 추출
8. 메트릭 데이터가 없는 경우 일반 랜덤 선택

**적용 시나리오**:
- 통계 기반이지만 완전히 결정적이지 않은 조합을 원하는 경우
- 빈도와 과거 데이터를 모두 고려한 랜덤 추출을 원하는 경우
- 다양한 조합을 생성하면서도 통계적 패턴을 반영하고 싶은 경우

**AI 요소**: ❌ 없음 (통계 기반 가중치 확률 분포)

---

### 6. 패턴 필터링 (PATTERN_MATCHER)

**설명**: 과거 당첨 데이터의 패턴(총합, 홀짝비, 고저비, 연속수 등)을 분석하여, 그 패턴과 일치하는 조합만 생성합니다. 말이 안 되는 조합을 걸러내는 전략입니다.

**특징**:
- 과거 당첨 데이터의 통계적 패턴 분석
- 총합, 홀짝비, 고저비, 연속수 등 다차원 패턴 검증
- 패턴 일치도 60% 이상인 조합만 선택
- 최대 1000회 시도하여 패턴 일치 조합 생성
- 말이 안 되는 조합 자동 필터링

**알고리즘**:
1. 1~45번 전체 번호를 후보 풀로 생성
2. 제약 조건(포함/제외 번호) 적용
3. 과거 당첨 데이터의 패턴 통계 계산 (총합, 홀짝비, 고저비, 연속수)
4. 가중치 기반 또는 일반 랜덤으로 조합 생성
5. 생성된 조합의 패턴 분석
6. 과거 당첨 패턴과 일치도 계산 (총합 30%, 홀짝비 25%, 고저비 25%, 연속수 20%)
7. 일치도가 60% 이상이면 선택, 미만이면 재시도
8. 최대 1000회 시도하여 패턴 일치 조합 생성
9. 과거 당첨 데이터가 없으면 기본 패턴 통계 사용

**적용 시나리오**:
- 과거 당첨 번호와 유사한 패턴의 조합을 원하는 경우
- 말이 안 되는 조합을 걸러내고 싶은 경우
- 통계적으로 검증된 패턴을 따르는 조합을 원하는 경우
- AI가 800만 개의 조합 중 과거 당첨 패턴과 일치하는 조합만 엄선하고 싶은 경우

**주의사항**:
- 패턴 일치도 임계값은 60%로 설정되어 있습니다
- 과거 당첨 데이터가 많을수록 더 정확한 패턴 분석이 가능합니다
- 최대 1000회 시도 내에 패턴 일치 조합을 찾지 못하면 일반 조합을 반환합니다

**AI 요소**: ❌ 없음 (통계 기반 패턴 분석)

---

## 전략 선택 가이드

### 어떤 전략을 선택해야 할까요?

1. **통계를 신뢰하는 경우** → `FREQUENT_TOP`
2. **역발상을 선호하는 경우** → `OVERDUE_TOP`
3. **균형잡힌 선택을 원하는 경우** → `BALANCED`
4. **5등 보장을 원하는 경우** → `WHEELING_SYSTEM`
5. **통계 기반 랜덤 추출을 원하는 경우** → `WEIGHTED_RANDOM`
6. **패턴 일치 조합을 원하는 경우** → `PATTERN_MATCHER`

### 게임 개수 선택

- **소액 구매**: 1~5게임 (`FREQUENT_TOP`, `OVERDUE_TOP`, `BALANCED`, `WEIGHTED_RANDOM`, `PATTERN_MATCHER`)
- **중간 구매**: 5~10게임 (`FREQUENT_TOP`, `OVERDUE_TOP`, `BALANCED`, `WEIGHTED_RANDOM`, `PATTERN_MATCHER`)
- **5등 보장**: 14게임 (`WHEELING_SYSTEM` - 권장, 변경 가능)

---

## 기술적 세부사항

### 구현 위치

- **프론트엔드**: `client-frontend/src/pages/GeneratePage.tsx`
- **백엔드 Preset**: `lotto-api/src/main/java/io/appback/lottoguide/domain/generator/preset/`
  - `FrequentTopPreset.java`
  - `OverdueTopPreset.java`
  - `BalancedPreset.java`
  - `WheelingSystemPreset.java`
  - `WeightedRandomPreset.java`
  - `PatternMatcherPreset.java`
- **백엔드 유틸리티**: `lotto-api/src/main/java/io/appback/lottoguide/domain/generator/preset/util/`
  - `WeightedRandomUtil.java` - 가중치 기반 랜덤 추출
  - `PatternAnalyzer.java` - 패턴 분석
- **백엔드 엔진**: `lotto-api/src/main/java/io/appback/lottoguide/domain/generator/engine/GeneratorEngine.java`
- **전략 Enum**: `lotto-api/src/main/java/io/appback/lottoguide/domain/generator/model/Strategy.java`

### 성능 고려사항

- 모든 전략은 메트릭 데이터를 캐시하여 빠른 응답 제공
- `WHEELING_SYSTEM`은 14개 조합을 한 번에 생성하므로 다른 전략보다 약간 더 많은 계산 필요
- 메트릭 데이터가 없는 경우 랜덤 선택으로 빠르게 응답

---

## 업데이트 이력

- **2026-01-14**: 초기 문서 작성
  - 4가지 전략 문서화
  - 전략별 기본 게임 개수 정의
  - Wheeling System 알고리즘 상세 설명 추가
- **2026-01-14**: 전략 확장
  - `WEIGHTED_RANDOM` 전략 추가 (가중치 기반 생성)
  - `PATTERN_MATCHER` 전략 추가 (패턴 필터링)
  - AI 요소 분류 가이드 문서 추가

---

## 참고 자료

- [API 명세서](./api-specification.md)
- [번호 생성 API 엔드포인트](./api-specification.md#번호-생성-api)
- [전략별 AI 요소 분류 가이드](./strategy-ai-classification.md) - AI 요소가 있는 전략과 없는 전략 구분
