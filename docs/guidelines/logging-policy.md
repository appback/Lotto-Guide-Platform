# Lotto Guide Platform 로깅 정책 (Logging Policy)

> **문서 버전**: 1.0  
> **최종 업데이트**: 2026-01-09  
> **작성자**: Lotto Guide Platform Development Team  
> **상태**: 정책 수립 완료  
> **참조**: .ai-config.json의 `logging_level_standards` 섹션

---

## 📋 로그 레벨 기준

### 1. TRACE (4) - 모든 행위에 대해 출력
**정의**: 가장 상세한 디버깅 정보로, 모든 실행 흐름을 추적

**사용 시점**:
- 메서드 진입/종료 지점
- 변수 값의 상세한 추적
- 조건문 분기 상세 정보
- 반복문 내부 상태 변화

### 2. DEBUG (3) - 개발 내에서만 필요한 로그
**정의**: 개발 과정에서 필요한 상세 정보

**사용 시점**:
- 메서드 시작/종료
- 주요 처리 단계
- 중간 결과값
- **인증 실패(401, 403) - 정상적인 비즈니스 로직**
- **토큰 만료 - 정상적인 비즈니스 로직**
- **사용자가 로그인하지 않은 경우 - 정상적인 비즈니스 로직**

**예시**:
```java
logger.debug("사용자 인증 시작: userId={}", userId);
logger.debug("인증 실패: username={}, status=401", username);
logger.debug("토큰 만료: status=401");
logger.debug("사용자 인증 완료: result={}", result);
```

### 3. INFO (2) - 성공/실패
**정의**: 일반적인 정보성 메시지로, 성공/실패를 명확히 구분

**사용 시점**:
- 애플리케이션 시작/종료
- 주요 비즈니스 로직 실행
- 사용자 액션 (로그인, 로그아웃, 데이터 생성/수정/삭제)
- 시스템 상태 변화

**예시**:
```java
logger.info("애플리케이션 시작 - 프로필: {}", activeProfile);
logger.info("사용자 로그인 성공: userId={}, ip={}", userId, ipAddress);
logger.info("번호 생성 완료: userId={}", userId);
```

### 4. WARN (1) - 예견된 실패나 예외처리된 에러 (알림 전달)
**정의**: 잠재적 문제나 예견된 실패 상황 (알림 전달 대상)

**사용 시점**:
- 성능 저하 가능성
- 권장되지 않는 사용법
- 임시 해결책 적용
- 외부 서비스 일시적 장애
- 사용량 한계 접근
- 보안 관련 경고
- **연결 실패 (네트워크, DB 등)**
- **타임아웃**
- **기타 HTTP 오류 (404, 500 등)**
- **권한 부족**
- **중복 사용자명/이메일 (회원가입 시)**
- **입력값 검증 실패**

**예시**:
```java
logger.warn("데이터베이스 연결 지연: responseTime={}ms", responseTime);
logger.warn("외부 서비스 일시적 장애: service={}", service);
logger.warn("권한 부족: userId={}, resource={}", userId, resource);
logger.warn("회원가입 실패 - 이미 사용 중인 사용자명 - username={}", username);
```

### 5. ERROR (0) - 예외처리되지 못한 예기치못한 에러 (알림 전달)
**정의**: 예외처리되지 못한 예기치 못한 에러 (알림 전달 대상)

> **⚠️ 중요**: 
> - 인증 실패(401, 403), 토큰 만료, 사용자가 로그인하지 않은 경우는 **정상적인 비즈니스 로직**이므로 ERROR가 아님
> - Exception 처리 규약은 반드시 예외 처리 가이드를 참조해야 합니다.

**사용 시점**:
- 예외처리되지 못한 예외
- 시스템 오류
- 데이터 손실 위험
- 보안 침해 시도
- 복구 불가능한 상황
- **원인을 모르는 예상치 못한 예외** (예측 불가능한 문제)

**예시**:
```java
// 예측 불가능한 문제: 원인을 알 수 없음
logger.error("❌ 예상치 못한 데이터베이스 연결 실패: userId={}", id, e);
logger.error("❌ 메모리 부족: availableMemory={}MB", availableMemory, e);
logger.error("❌ 보안 침해 시도 감지: ip={}, action={}", ipAddress, action, e);
logger.error("❌ 시스템 크래시 발생", e);
logger.error("❌ 예상치 못한 예외 발생", e);
```

---

## 🔄 상황별 로그 레벨

### 인증/보안 관련

| **상황** | **에러 코드** | **로그 레벨** | **이유** |
|----------|---------------|---------------|----------|
| **인증 성공** | - | `INFO` | 정상적인 비즈니스 로직 |
| **인증 실패 (401, 403)** | `UNAUTHORIZED`, `FORBIDDEN` | `DEBUG` | 정상적인 비즈니스 로직 |
| **토큰 만료** | `UNAUTHORIZED` | `DEBUG` | 정상적인 비즈니스 로직 |
| **권한 부족** | `FORBIDDEN` | `WARN` | 예견된 문제 |
| **중복 사용자명/이메일** | `DUPLICATE_USERNAME`, `DUPLICATE_EMAIL` | `WARN` | 예견된 문제 |
| **보안 침해 시도** | - | `ERROR` | 예상치 못한 보안 위협 |

### 외부 서비스 관련

| **상황** | **에러 코드** | **로그 레벨** | **이유** |
|----------|---------------|---------------|----------|
| **외부 API 호출/응답** | - | `DEBUG` | 개발 정보 |
| **외부 API 실패 (4xx, 5xx)** | `EXTERNAL_SERVICE_ERROR` | `WARN` | 예견된 문제 |
| **연결 실패/타임아웃** | `EXTERNAL_SERVICE_ERROR` | `WARN` | 예견된 문제 |
| **외부 서비스 장애** | `EXTERNAL_SERVICE_ERROR` | `ERROR` | 예상치 못한 시스템 오류 |

### 데이터베이스 관련

| **상황** | **에러 코드** | **로그 레벨** | **이유** |
|----------|---------------|---------------|----------|
| **SQL 쿼리 실행** | - | `DEBUG` | 개발 정보 |
| **트랜잭션 롤백** | - | `WARN` | 예견된 문제 |
| **연결 실패** | `INTERNAL_ERROR` | `ERROR` | 예상치 못한 시스템 오류 |

---

## 📋 핵심 원칙

1. **인증 실패는 정상적인 비즈니스 로직**: 인증 실패(401, 403), 토큰 만료는 `DEBUG` 레벨로 처리. `ERROR`는 절대 사용하지 않음.

2. **ERROR는 예상치 못한 예외만**: `ERROR`는 예외처리되지 못한 예기치 못한 에러만 사용.

3. **WARN은 예견된 문제**: 연결 실패, 타임아웃, HTTP 오류, 중복 사용자명/이메일, 입력값 검증 실패 등 예견된 문제는 `WARN`으로 처리.

4. **DEBUG는 정상적인 비즈니스 로직**: 인증 실패, 토큰 만료 등 정상적인 비즈니스 로직은 `DEBUG`로 처리.

---

> **이 정책은 Lotto Guide Platform 시스템의 로그 레벨 기준입니다.  
> 로그 레벨 관련 이슈 발생 시 반드시 이 문서를 참조하세요.**
